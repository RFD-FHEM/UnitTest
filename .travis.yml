dist: xenial
sudo: enabled
language: perl
perl:
- '5.26'
- '5.24'
- '5.18'
env:
  global: 
    secure: dbyqR7+kY3Saznhumq1y/zuJdR5eHlTO5dl4QFqb2N4fpCstqzelpF48h9ClNy3lRxDYmiElb5UNkdQVG4NWCcurtSSSeVP97BmNzA4lENQfx8J87gFh5n0AwjN8G8gogcPQgYlTT3VUwgDSfnPSqYJZX81+hIZ63+5aiO7MEAvwxwFILyzZYs8kItYjxiMlzcDHZ77t0dmX6HoMDbNG5bVqYFO0Q8H5pTyUlU1jF3KjNXPKspPRtvfZZMHdg2DBF4hN3LfcsM+PW5EgOLcRNYiLqclGpv5VDACjBIDurTUqnSqHaXUA5O49YNid8jb2dHbPZdaYpy/TdJp0kniQuXsUSu282xQ4XCaDcqm0VnWNEhMFiYzeaDxDtGKHqvvNP1xZOtWctq+aZzggIzKGZ4hu6Lg+tVVr96c59fZbSrybISuR/sCmXDkiM/trsudPotaiEK4snnmi1oa/CWcGGya2jqgs7DVYh9LlIbxIcgIIKfa0kEmm1rWhVfQJvpqp36+pylo07zaKwUVIvYUNNuu8+yC3quypgpY3PG2vjm8E/DgFlCAnQJd6lyG+qgSGWHYZZAc5rGFN6mksVAET9BX4R5IZFZyaaNOsezAUk5rA6mBoCTBt2+z3egdA7haycDNiT5TAvOL6sdbNwnLFmmvmp63QkfDdQY2fFdgMM7A=
git:
  depth: false
before_install:
- git config --global user.email "travis@travis-ci.org"
- git config --global user.name "Travis CI"
- git config --global push.default simple
- git remote set-url origin https://${GH_API_KEY}@github.com/RFD-FHEM/UnitTest.git
- wget -qO - http://debian.fhem.de/archive.key | sudo apt-key add -
- echo "deb http://debian.fhem.de/nightly/ /" | sudo tee -a /etc/apt/sources.list
install:
- sudo apt-get update -qq
- cpanm File::Find File::Basename Mock::Sub Test::More Test::Device::SerialPort JSON
  --notest
- sudo apt-get install fhem -qq -y
- sudo chown travis -R /opt/fhem
script:
- make test -j2
- make fhem_kill
- ./build_controls_list.sh
- git commit -m "Travis automatic update controls file. Build (${TRAVIS_BUILD_NUMBER})
  [skip ci]" ./controls_unittest.txt || true
- if [ "$TRAVIS_PULL_REQUEST" = "false" ] && [[ $TRAVIS_JOB_NUMBER == *.1 ]]; then
  git push origin HEAD:$TRAVIS_BRANCH ; fi
