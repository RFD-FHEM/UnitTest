dist: xenial
sudo: enabled
language: perl
perl:
- '5.26'
- '5.24'
- '5.22'
env:
  global:
    secure: Fk8t0icPoREVjHgBHqeFL0N0+o0s/f+AVE85PlfaxJ0GLSEwUdY17t8qI9rsnscco2EvVkgxaktEuUCZB5t7ang6ndrlo75PMiyrblFMzjHAkpasOiFE6ysc2ykdtwxBliRc71TYRrciRiVQUDf3mpef6vAa1zvQ1Ii1pTF5sua1eoamETwafAjuJvY9fohMKaVCOmHcv89vhbWzkptQiVXq5afoN69iOQawLUr5DdAHhVEF1CGGX5vzUS+25tvQqpoyrrH2Mqenhs3O1PK9fSJJsRf6B9PsorZhcKa66lFZsKOa3dyCYhlT4eyhecK1eAP8OKZDAKOP4sNK5Psik8/EOrbCGcZnKbZ/QtjJr44+40IyaWv/YgSxB5ZbR3HOHxKXFvjDfKa1EJ/xtf3YSik3XM6Mixfiu8iy5h+n1HkDGYI5K1IshfK5sGMUUJiPQEPW43MOOuAv131QV9wPqwUYG1+o/RSjxse3BgTGAFc/1eMbmYdfGv6qFp31ogJJDjUl7fSQ7rEtcYD1AbTy5nPPy3AG658A5fbTceJEH5WIuUMyYljTPA4kS7Rbp0gus+sxqDiET8inpULa973sCW4W2Sh785aUJHghYDDSJkKhhrZ/jrX+alidw9CF2slaj0+Rdlq8WQN2F/jySUSjYfSwu3/Fvbv61Uril5Imw1U=
git:
  depth: false
before_install:
- git config --global user.email "travis@travis-ci.org"
- git config --global user.name "Travis CI"
- git config --global push.default simple
- git remote set-url origin https://${GH_API_KEY}@github.com/RFD-FHEM/UnitTest.git
- wget -qO - http://debian.fhem.de/archive.key | sudo apt-key add -
- echo "deb http://debian.fhem.de/nightly/ /" | sudo tee -a /etc/apt/sources.list
install:
- sudo apt-get update -qq
- cpanm File::Find File::Basename Mock::Sub Test::More Test::Device::SerialPort JSON
  --notest
- sudo apt-get install fhem -qq -y
- sudo chown travis -R /opt/fhem
script:
- make test -j2
- make fhem_kill
- ./build_controls_list.sh
- git commit -m "Travis automatic update controls file. Build (${TRAVIS_BUILD_NUMBER})
  [skip ci]" ./controls_unittest.txt || true
- if [ "$TRAVIS_PULL_REQUEST" = "false" ] && [[ $TRAVIS_JOB_NUMBER == *.1 ]]; then
  git push origin HEAD:$TRAVIS_BRANCH ; fi
